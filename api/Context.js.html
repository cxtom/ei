<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Context.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Context.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file context
 * @author Leon(leon@outlook.com)
 */

var u = require('underscore');

var invariant = require('./util/invariant');

/**
 * `ei`视图上下文
 *
 * @constructor
 * @param {*} initialValue 初始化状态
 * @param {!Function} reducer 裁剪器
 */
function Context(initialValue, reducer) {

    invariant(u.isFunction(reducer), 'Context need a reducer');

    /**
     * 剪裁器
     *
     * @private
     * @member {Function}
     */
    this.reducer = reducer;

    /**
     * 数据仓库
     *
     * @private
     * @member {*}
     */
    this.store = initialValue;

    this.dispatch = u.bind(this.dispatch, this);

    this.getState = u.bind(this.getState, this);

    /**
     * 数据变化侦听函数
     *
     * @private
     * @member {Array.&lt;Function>}
     */
    this.listeners = [];

}

/**
 * 对当前的数据进行剪裁
 *
 * @public
 * @param  {*}       state 数据状态
 * @param  {!Object} action 动作
 * @return {*} 新的数据状态
 */
Context.prototype.reduce = function (state, action) {
    return this.reducer(state, action);
};

/**
 * 获取当前上下文中的数据
 *
 * @public
 * @return {*}
 */
Context.prototype.getState = function () {
    return this.store;
};

/**
 * 设置当前的数据状态
 *
 * @param {*} store 数据状态
 * @return {module:Context}
 */
Context.prototype.setState = function (store) {
    this.store = store;
    return this;
};


/**
 * 派发动作，激活数据剪裁
 *
 * @public
 * @param {!Object} action 动作
 * @return {Object} 动作
 */
Context.prototype.dispatch = function (action) {

    if (u.isFunction(action)) {
        return action(this.dispatch, this.getState);
    }

    var nextState = this.reduce(this.store, action);

    this.setState(nextState);

    for (var listeners = this.listeners.slice(), i = 0, len = listeners.length; i &lt; len; ++i) {
        listeners[i]();
    }

    return action;

};

/**
 * 添加数据变化侦听器
 *
 * @public
 * @param {!Function} handler 处理函数
 * @return {module:Context}
 */
Context.prototype.addChangeListener = function (handler) {
    this.listeners.push(handler);
    return this;
},

/**
 * 移除数据变化侦听器
 *
 * @param {!Function} handler 处理函数
 * @return {module:Context}
 */
Context.prototype.removeChangeListener = function (handler) {

    for (var listeners = this.listeners, i = listeners.length - 1; i >= 0; --i) {
        if (listeners[i] === handler) {
            listeners.splice(i, 1);
            return this;
        }
    }

    return this;

};

module.exports = Context;

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ei.html">ei</a></li><li><a href="module-env.html">env</a></li><li><a href="module-events.html">events</a></li><li><a href="module-locator.html">locator</a></li><li><a href="module-resource.html">resource</a></li><li><a href="module-url.html">url</a></li></ul><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="Container.html">Container</a></li><li><a href="Context.html">Context</a></li><li><a href="ContextConnector.html">ContextConnector</a></li><li><a href="ContextProvider.html">ContextProvider</a></li><li><a href="Emitter.html">Emitter</a></li><li><a href="Page.html">Page</a></li><li><a href="Router.html">Router</a></li></ul><h3>Events</h3><ul><li><a href="module-events.html#~event:app-bootstrap">app-bootstrap</a></li><li><a href="module-events.html#~event:app-load-page-on-client">app-load-page-on-client</a></li><li><a href="module-events.html#~event:app-load-page-on-server">app-load-page-on-server</a></li><li><a href="module-events.html#~event:app-page-bootstrap">app-page-bootstrap</a></li><li><a href="module-events.html#~event:app-page-bootstrap-succeed">app-page-bootstrap-succeed</a></li><li><a href="module-events.html#~event:app-page-loaded">app-page-loaded</a></li><li><a href="module-events.html#~event:app-page-switch-succeed">app-page-switch-succeed</a></li><li><a href="module-events.html#~event:app-ready">app-ready</a></li><li><a href="module-events.html#~event:app-request">app-request</a></li><li><a href="module-events.html#~event:app-response-in-html">app-response-in-html</a></li><li><a href="module-events.html#~event:app-response-in-json">app-response-in-json</a></li><li><a href="module-events.html#~event:app-route">app-route</a></li><li><a href="module-events.html#~event:app-route-failed">app-route-failed</a></li><li><a href="module-events.html#~event:app-route-succeed">app-route-succeed</a></li><li><a href="module-events.html#~event:page-dispatch">page-dispatch</a></li><li><a href="module-event.html#~event:page-dispose">page-dispose</a></li></ul><h3>Global</h3><ul><li><a href="global.html#routes">routes</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Fri Jul 31 2015 21:12:48 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
